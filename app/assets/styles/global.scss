@use "sass:color";
@use "variables" as *;
@use "dark-mode" as *;
@use "bulma/sass" as bulma with (
  $family-sans-serif: $family-sans-serif,
  $primary: $primary,
  $info: $info,
  $success: $success,
  $warning: $warning,
  $danger: $danger,
  $custom-colors: $custom-colors,
  $text: $text,
  $body-size: $body-size,
  $link: $link,
  $title-family: $title-family,
  $subtitle-family: $subtitle-family,
  $body-background-color: $body-background-color,
  $box-background-color: $box-background-color,
  $navbar-height: $navbar-height,
  $section-padding: $section-padding,
  $section-padding-desktop: $section-padding-desktop,
  $footer-padding: $footer-padding,
  $title-weight: $title-weight,
  $subtitle-color: $subtitle-color,
  $size-1: $size-1,
  $size-2: $size-2,
  $size-3: $size-3,
  $size-4: $size-4,
  $size-5: $size-5,
  $size-6: $size-6,
  $size-7: $size-7,
  $menu-item-radius: $menu-item-radius,
  $menu-list-link-padding: $menu-list-link-padding,
  $radius-small: $radius-small,
  $box-shadow: $box-shadow,
  $box-padding: $box-padding,
  $tabs-border-bottom-width: $tabs-border-bottom-width,
  $tabs-link-active-color: $tabs-link-active-color,
  $tabs-link-active-border-bottom-color: $tabs-link-active-border-bottom-color,
  $tabs-link-color: $tabs-link-color,
  $input-shadow: $input-shadow,
  $label-weight: $label-weight,
  $label-color: $label-color
);

.tag.is-success {
  background-color: $white !important;
}

// Table column alignment for consistent two-column tables
.table.two-column-labels tbody tr td:first-child {
  width: 40%;
  min-width: 226px;
  white-space: nowrap;
}


// Section titles
.title.is-5 {
  color: $text;
  font-weight: $weight-normal;
}

.button {
  &.is-wide {
    min-width: 140px;
  }

  &.is-wider {
    min-width: 170px;
  }

  &.is-widest {
    min-width: 220px;
  }

  &.is-small {
    padding-top: 3px;
    padding-bottom: 3px;
  }
  &.is-text {
    text-decoration: none;
  }

  &:focus,
  &:focus-visible,
  &:active,
  &:focus:not(:active) {
    outline: none !important;
    box-shadow: none !important;
  }

  // Only apply border and background overrides to buttons without color classes
  &:not(.is-primary):not(.is-secondary):not(.is-success):not(.is-danger):not(.is-warning):not(.is-info):not(.is-light):not(.is-dark):not(.is-link) {
    &:hover,
    &:focus,
    &:focus-visible,
    &:active,
    &:focus:not(:active) {
      border-color: #dbdbdb !important;
      border-width: 1px !important;
      background-color: inherit;
    }
  }
}

$state-filter-outline-colors: (
  "is-primary": ("bg": $primary, "color": $primary-invert),
  "is-success": ("bg": $success, "color": $white),
  "is-info": ("bg": $info, "color": $white),
  "is-warning": ("bg": $warning, "color": $black),
  "is-danger": ("bg": $danger, "color": $white),
  "is-dark": ("bg": $dark, "color": $white)
);

.state-filter {
  .button.is-outlined {
    border-width: 1px;
    box-sizing: border-box;
    --bulma-button-border-width: 1px;
    transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
  }

  @each $modifier, $settings in $state-filter-outline-colors {
    $background: map-get($settings, "bg");
    $text-color: map-get($settings, "color");

    .button.#{$modifier}.is-outlined {
      border-width: 1px;
      box-sizing: border-box;
      --bulma-button-border-width: 1px;

      &:hover,
      &.is-hovered {
        border-width: 1px;
        box-sizing: border-box;
        --bulma-button-border-width: 1px;
        background-color: $background;
        border-color: $background;
        color: $text-color !important;
        box-shadow: none;
      }
    }
  }
}

// Dropdown styling
.dropdown-menu {
  .dropdown-content {
    background: $white;
    border: 1px solid $grey-lighter;
    border-radius: $radius;
    box-shadow: $box-shadow;
    padding: 0.25rem;
  }

  .dropdown-item {
    color: $text-dark;
    font-size: $size-6;
    font-weight: $weight-medium;
    padding: 0.5rem 1rem;
    border-radius: $radius-small;
    display: flex;
    align-items: center;
    
    svg {
      color: inherit;
    }
    
    img[src$=".svg"] {
      filter: brightness(0) saturate(100%) invert(48%) sepia(9%) saturate(665%) hue-rotate(180deg) brightness(93%) contrast(87%);
    }
    
    &:hover {
      background: $grey-lightest;
      color: $text;
    }
  }

  .dropdown-divider {
    background-color: $grey-lighter;
    margin: 0.25rem 0;
  }
}

// Action button styling (matching dropdown-item style)
.action-btn,
.group-action-btn {
  padding: 0.5rem 1rem;
  border-radius: $radius-small;
  border: 1px solid $grey-lighter;
  background: $white;
  color: $text-dark;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  box-shadow: $button-shadow;
  font-size: $size-6;
  font-weight: $weight-medium;
  
  .icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    
    img {
      display: block;
      flex-shrink: 0;
      filter: brightness(0) saturate(100%) invert(48%) sepia(9%) saturate(665%) hue-rotate(180deg) brightness(93%) contrast(87%);
    }
  }

  &:hover:not(:disabled) {
    background: $grey-lightest;
    border-color: $grey-light;
  }

  &:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
  
  &.is-loading {
    position: relative;
    color: transparent;
    
    span {
      opacity: 0;
    }
    
    &:after {
      position: absolute;
      content: "";
      left: calc(50% - 0.5em);
      top: calc(50% - 0.5em);
      width: 1em;
      height: 1em;
      border: 2px solid $grey-light;
      border-radius: 50%;
      border-right-color: transparent;
      border-top-color: transparent;
      animation: spinAround 0.5s infinite linear;
    }
  }
}

// Port badge styling - smaller size
.port-badge {
  display: inline-block;
  padding: 0.15rem 0.35rem;
  background: rgba($secondary, 0.1);
  color: $secondary;
  border: 1px solid $secondary;
  border-radius: $radius-small;
  text-decoration: none;
  transition: all 0.2s ease;
  font-size: $size-7;
  line-height: 1.2;
  
  &:hover {
    background: $secondary;
    color: $white;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba($secondary, 0.2);
  }
}

// Remove bottom margin from content.mb-5
.content.mb-5 {
  margin-bottom: 0 !important;
}

// Wallet authentication banner
.wallet-auth-banner {
  border-left: 4px solid $secondary;
  
  .banner-icon {
    color: $secondary;
    flex-shrink: 0;
  }
  
  .banner-title {
    font-weight: $weight-semibold;
    margin-bottom: 0.25rem;
    color: $text;
  }
  
  .banner-subtitle {
    font-size: $size-7;
    color: $text-dark;
    line-height: 1.4;
  }
  
  .banner-actions {
    gap: 0.5rem;
  }
}

// Tab button styling (used for navigation tabs and toggle buttons)
.tab-button {
  background: $white;
  border: 1px solid $grey-lighter;
  color: $text-dark;
  padding: 0.5rem 1rem;
  border-radius: $radius;
  cursor: pointer;
  font-size: $size-6;
  font-weight: $weight-medium;
  transition: all 0.2s;

  // Ensure leading icons are perfectly centered relative to the label
  .icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
    line-height: 0;
    margin: 0; // reset default margins

    svg,
    img,
    span {
      display: block;
    }
  }

  // spacing when icon is on the left of text
  .icon:first-child { margin-right: 0.5rem; }
  // spacing when icon is on the right of text (e.g., dropdown arrow)
  .icon:last-child { margin-left: 0.5rem; }

  &:hover {
    background: $grey-lightest;
  }

  &.is-active {
    background: $primary;
    color: $white;
    border-color: $primary;
  }
}


// Deployment tabs container styling (used for tab navigation containers)
.deployment-tabs {
  display: flex;
  gap: 8px;
  flex-wrap: nowrap;
  align-items: center;
  overflow: visible;
  
  .tab-button {
    min-width: auto; // allow natural width
    white-space: nowrap; // prevent wrap but allow full label
    text-align: center;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding-left: 0.9rem; // ensure text not cut off
    padding-right: 0.9rem;
  }
}

.table.is-narrow td,
.table.is-narrow th {
  line-height: 1;
}

.box {
  position: relative;
}

.menu {
  font-family: $title-family;

  .menu-list a {
    display: flex;
    align-items: center;
  }

  .menu-list a[disabled] {
    opacity: 0.5;
  }
}

.sidebar {
  .menu-list a {
    color: $menu-item-color;
    transition: color 0.2s ease;

    span:not(.icon) {
      color: inherit;
    }
  }

  .menu-list .icon {
    color: $menu-item-color;
  }
  .menu-list a:not(.deploy-cta) {
    background-color: transparent !important;	
  }
}


/* Extra bulma classes */
.has-radius {
  border-radius: $radius;
}

.has-radius-small {
  border-radius: $radius-small;
}

.has-radius-large {
  border-radius: $radius-large;
}

.has-limited-width {
  width: 650px;
  max-width: 100%;
}

.has-limited-width-small {
  width: 560px;
  max-width: 100%;
}

.has-limited-width-smaller {
  width: 460px;
  max-width: 100%;
}

.has-limited-width-smallest {
  width: 320px;
  max-width: 100%;
}

.has-overflow-scroll {
  overflow-y: auto;
  height: 100%;
}

.is-disabled {
  pointer-events: none;
  cursor: not-allowed;
}

::-webkit-scrollbar-track-piece {
  border-radius: 6px;
  background: transparent;
}

::-webkit-scrollbar-thumb {
  border-radius: 6px;
  background: #e4e4e4;
}

::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

@include touch {
  .has-navbar-fixed-top-mobile {
    padding-top: $navbar-height;
  }
}

:root {
  /* Buttons. */
  --swv-button-background-color: black !important;
  --swv-button-outline-color: white !important;
  --swv-button-hover-background-color: #353535 !important;
  --jse-theme-color: #353535;
}
.jse-theme-dark {
  --jse-theme-color: #353535 !important;
}

.swv-button {
  font-family: inherit !important;
  font-weight: 400 !important;
  line-height: 1.1 !important;
}
.swv-button-trigger {
  border: 1px solid var(--swv-button-outline-color) !important;
}

.swv-dropdown-list {
  font-family: inherit !important;
}

.swv-modal-wrapper {
  font-family: inherit !important;
}

.tag.is-outlined {
  border: 1px solid;
}

.is-fullwidth {
  width: 100%;
}

.light-mode {
  .dark-only {
    display: none;
  }
}

.has-background-body {
  background-color: $body-background-color !important;
}

.address {
  -webkit-line-clamp: 1;
  line-clamp: 1;
  -webkit-box-orient: vertical;
  display: -webkit-box;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: normal;
  word-break: break-all;
}

.status-dot {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  margin-right: 8px;
}

.dot-checking {
  background-color: $info;
  animation: pulse 1.5s infinite;
}

.dot-online {
  background-color: $success;
}

.dot-offline {
  background-color: $danger;
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
  }

  50% {
    opacity: 0.5;
  }
}

.modal-card {
  width: 420px;
  max-width: 90%;
  
  &.modal-card-wide {
    width: 90%;
    max-width: 1200px;
  }
  
  &-body {
    &.modal-card-body-scrollable {
      max-height: 70vh;
      overflow-y: auto;
    }
  }
}

.modal-card-title {
  font-family: $title-family;
}

.w-100 {
  width: 100%;
}

/* Ensure modal tooltips are not covered by header */
.modal-card-head {
  overflow: visible; /* let bubbles extend over the header edge */
  position: relative;
  z-index: auto !important; /* avoid creating stacking context above tooltips */
}
.modal-card-body {
  position: relative; /* create stacking context above header */
  z-index: auto !important;
  overflow-x: hidden !important;
}

.modal.is-active .modal-card [data-tooltip] {
  &::before,
  &::after {
    z-index: 1000000 !important; /* ensure above modal UI */
  }
}

/* Ensure the trigger itself participates in the higher stacking context */
.modal.is-active .modal-card .has-tooltip-arrow {
  position: relative !important;
  z-index: 2003 !important;
}

button[disabled][data-tooltip] {
  pointer-events: auto;
  &:hover {
    cursor: not-allowed;
  }
}

/* Add before dark-mode styles */
.dropdown-item {
  &:hover {
    strong, .has-text-weight-bold {
      color: $secondary !important;
    }
  }
}

/* Market indicator styles */
.market-select-indicator {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  border: 1px solid #e0e0e0;
  margin-right: 10px;
  vertical-align: middle;
}

.market-select-indicator.selected:before {
  content: "";
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background-color: $secondary;
}

/* Dropdown styles */
.dropdown {
  position: relative;
  width: 100%;

  &-content {
    max-height: none !important;
    padding: 0;
    background-color: var(--background-color, white);
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  &-item {
    padding: 0.4rem 1rem;
    display: flex;
    align-items: center;
    border-radius: 0;

    &:first-child {
      border-radius: 4px 4px 0 0;
    }

    &:last-child {
      border-radius: 0 0 4px 4px;
    }

    &:hover {
      background-color: #f5f5f5;
    }
  }

  &-trigger button {
    display: flex;
    align-items: center;
    width: 100%;
    justify-content: flex-start;
    padding: 0.5rem 1rem;
    height: auto;
  }

  &-menu {
    width: 100%;
    position: absolute;
    left: 0;
    margin-top: 2px;
  }
}

.modal-card {
  width: 360px;
  max-width: 90%;
  overflow: visible !important; /* allow tooltips to escape card bounds */

  &-body {
    overflow-y: visible !important;
    padding-bottom: 1rem;
  }
}

.is-borderless {
  border: none !important;
  box-shadow: none !important;
}

/* Dropdown styles */
.status-select {
  select {
    min-width: 120px;
    text-align: left;
    text-align-last: left;
    border-radius: 4px;
    border: 1px solid $grey-lighter;
    outline: none !important;
    box-shadow: none !important;
    padding-left: 12px;
    
    &:focus {
      border-color: $grey-light;
    }
    
    option {
      text-align: left;
      border: 1px solid $grey-lighter;
      border-radius: 4px;
      margin: 2px;
      padding: 4px 8px;
      
      &.has-text-success {
        color: $success !important;
        border-color: $success;
      }
      
      &.has-text-info {
        color: $info !important;
        border-color: $info;
      }
      
      &.has-text-warning {
        color: $warning !important;
        border-color: $warning;
      }
      
      &.has-text-dark {
        color: $dark !important;
        border-color: $dark;
      }

      &:hover {
        background-color: $grey-lighter;
      }
    }
  }
}

/* Filter button styles */
.button-filter {
  &.button {
    &:hover,
    &:focus,
    &:active {
      background-color: inherit !important;
      border-color: inherit !important;
      color: inherit !important;
    }

    &.is-primary {
      &:hover,
      &:focus,
      &:active {
        background-color: $primary !important;
        border-color: $primary !important;
        color: $primary-invert !important;
      }
    }

    &.is-outlined {
      &:hover,
      &:focus,
      &:active {
        background-color: transparent !important;
        border-color: inherit !important;
        color: inherit !important;
      }
    }
  }
}

// Ensure all modals appear above profile dropdowns and other UI elements
.modal {
  z-index: 1001 !important;
  overflow: visible !important; /* prevent clipping inside modal container */
}

/* ==========================================================================
   Clickable Table Rows
   ========================================================================== */

.clickable-row {
  position: relative;
  cursor: pointer;
  transition: background-color 0.2s ease;

  &:hover {
    background-color: rgba(0, 0, 0, 0.02);
  }
}

.clickable-row-link {
  display: block;
  color: inherit;
  text-decoration: none;

  &:hover {
    color: inherit;
  }

  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }
}

/* This is intentionally left empty. */
/* The class is used as a semantic hook in the HTML. */
.clickable-row-cell-content {
}

/* ==========================================================================
   Global Status Colors and Icons
   ========================================================================== */

/* Status color mapping to ensure consistency across all components */
:root {
  --status-success-color: #{$success}; // Green for completed/success
  --status-info-color: #{$info}; // Blue for running/pending  
  --status-warning-color: #{$warning}; // Orange for queued
  --status-danger-color: #{$danger}; // Red for failed/error
  --status-dark-color: #{$dark}; // Gray for stopped/default
}

/* Global status tag styling with consistent colors */
.tag.status-tag.is-outlined {
  background-color: transparent !important;
  
  &.is-success {
    color: var(--status-success-color) !important;
    border-color: var(--status-success-color) !important;
    
    svg {
      color: var(--status-success-color) !important;
    }
  }
  
  &.is-info {
    color: var(--status-info-color) !important;
    border-color: var(--status-info-color) !important;
    
    svg {
      color: var(--status-info-color) !important;
    }
  }
  
  &.is-warning {
    color: var(--status-warning-color) !important;
    border-color: var(--status-warning-color) !important;
    
    svg {
      color: var(--status-warning-color) !important;
    }
  }
  
  &.is-danger {
    color: var(--status-danger-color) !important;
    border-color: var(--status-danger-color) !important;
    
    svg {
      color: var(--status-danger-color) !important;
    }
  }
  
  &.is-dark {
    color: var(--status-dark-color) !important;
    border-color: var(--status-dark-color) !important;
    
    svg, .status-icon-wrap, .status-icon {
      color: var(--status-dark-color) !important;
      fill: var(--status-dark-color) !important;
    }
  }
}

/* Status tag base: outlined with transparent bg; color via class mapping */
.tag.status-tag {
  background-color: $white;
}

/* Center status icons inside tags */
.status-icon-wrap {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  vertical-align: middle;
  line-height: 0;
  
  svg {
    color: inherit;
  }
}

/* Global tooltip fixes - ensure tooltips render above and are not clipped */
[data-tooltip] {
  position: relative;
  &::before,
  &::after {
    z-index: 1002 !important; /* above .modal (1001) */
  }
  &::before {
    white-space: normal !important;
    max-width: 360px !important;
    min-width: 180px !important;
    padding: 10px 12px !important;
    line-height: 1.35 !important;
    text-align: left !important;
    border-radius: 8px !important;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.18) !important;
    word-break: keep-all !important;
    overflow-wrap: anywhere !important;
    hyphens: manual !important;
  }
}

/* Global info icon styling for tooltips */
.icon.has-tooltip-arrow {
  color: #7a7a7a;
  cursor: default;
  vertical-align: middle;
  margin-left: 0.25rem;
  text-decoration: none !important;
  border-bottom: none !important;
  
  &:hover {
    color: #363636;
    text-decoration: none !important;
    border-bottom: none !important;
  }
}
/* Utility classes for consistent spacing and sizing */
.has-min-width-250 {
  min-width: 250px;
  width: 250px;
}

.has-min-width-150 {
  min-width: 150px;
}

.has-min-width-140 {
  min-width: 140px;
}

.icon-16 {
  width: 16px;
  height: 16px;
}

.transform-rotate-270 {
  transform: rotate(-90deg);
}

.dropdown-arrow {
  transition: transform 0.2s ease;
  transform: rotate(90deg);
  
  &.is-rotated {
    transform: rotate(0deg);
  }
}

/* Shared header separator for top sections (deployments, jobs, etc.) */
.deployment-header {
  border-bottom: 1px solid $grey-lighter;
}

html.dark-mode .deployment-header {
  border-bottom-color: $grey-dark;
}

.has-min-height-500 {
  min-height: 500px;
}

.has-height-500 {
  height: 500px;
}

.back-button.is-ghost {
  border: none !important;
  
  &:hover,
  &:focus,
  &:active {
    background-color: transparent !important;
    border: none !important;
    box-shadow: none !important;
  }
}

/* Utility classes for event/task display */
.event-message {
  white-space: pre-wrap;
  word-break: break-word;
}

.time-display {
  min-width: 140px;
  text-align: right;
}

/* Quick detail column styling */
.quick-detail-column {
  min-width: 220px;
  margin-bottom: 0.75rem;
}

/* Ensure SMIL animations start immediately + CSS fallback for instant start */
.tag.status-tag.is-warning .status-icon-wrap svg path:nth-child(2),
.tag.status-tag.is-info .status-icon-wrap svg path:nth-child(2) {
  /* CSS animation as fallback - will be overridden by SMIL if working */
  animation: statusSpinFallback 4s linear infinite;
  transform-origin: 8.95px 8.85px;
}

@keyframes statusSpinFallback {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Force SMIL animations to restart immediately when component mounts */
.tag.status-tag.is-warning .status-icon-wrap svg,
.tag.status-tag.is-info .status-icon-wrap svg {
  /* Force browser to recalculate animations */
  animation: none;
}

.tag.status-tag.is-warning .status-icon-wrap svg *,
.tag.status-tag.is-info .status-icon-wrap svg * {
  /* Ensure SMIL animations are not paused */
  animation-play-state: running !important;
}

/* ==========================================================================
   JSON Editor Container Styling (Consistent across all uses)
   ========================================================================== */

/* Global class for JSON editor containers to ensure consistent styling */
.json-editor-container {
  background-color: $grey-lightest !important;
  border-radius: 4px;
  padding: 0;
  margin-top: 0.2rem;
  position: relative; /* For copy button positioning */
  
  .json-editor {
    min-height: 300px;
    border: none;
    border-radius: 4px;
    background-color: $grey-lightest !important;
    
    :deep(.jse-main) {
      border: none;
      background-color: $grey-lightest !important;
    }
    
    :deep(.jse-contents) {
      border-radius: 4px;
      background-color: $grey-lightest !important;
    }
    
    :deep(.jse-text-mode) {
      background-color: $grey-lightest !important;
    }
    
    :deep(.cm-editor) {
      background-color: $grey-lightest !important;
    }
    
    :deep(.cm-focused) {
      background-color: $grey-lightest !important;
    }
  }
}

/* Override any box backgrounds when containing JSON editor */
.box .json-editor-container {
  background-color: $grey-lightest !important;
}

/* ==========================================================================
   Category Tag Styling (Events Tab and Other Lists)
   ========================================================================== */

/* Ensure category tags are visible in both light and dark modes */
.category-tag {
  background-color: $grey-lightest !important;
  color: $text !important;
  border: 1px solid $grey-lighter !important;
}
/* ==========================================================================
   Back Arrow Icon Styling (Global for all pages)
   ========================================================================== */

/* Ensure back arrows are visible in both light and dark modes */
.back-arrow-icon {
  color: $text !important;
}
/* Ensure back buttons don't inherit link colors */
.back-button .back-arrow-icon {
  color: $text !important;
}

/* ==========================================================================
   Global Dark Mode Box Styling (Using Bulma Variables)
   ========================================================================== */



@media screen and (max-width: 768px) {
  .is-flex-direction-column-mobile {
    flex-direction: column !important;
  }
}
